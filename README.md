# *Hands on gulpTasks*, branch gulpTasks.

This exercise will expose the basics of pipe line streams, errorcodes and callbacks. 

#### A) Checkout branch *gulpTasksStart*


As you run the command `npm run gulp` you will realise the following error is thrown in the console.

```
/Users/pablomolina/Projects/gulpAcademy/node_modules/gulp-iconfont/node_modules/gulp-ttf2woff2/node_modules/ttf2woff2/jssrc/ttf2woff2.js:1
aughtException",(function(ex){if(!(ex instanceof ExitStatus)){throw ex}}));Mod
                                                                    ^
Error: no writecb in Transform class
    at afterTransform (/Users/pablomolina/Projects/gulpAcademy/node_modules/gulp-imagemin/node_modules/imagemin/node_modules/through2/node_modules/readable-stream/lib/_stream_transform.js:95:33)
    at TransformState.afterTransform (/Users/pablomolina/Projects/gulpAcademy/node_modules/gulp-imagemin/node_modules/imagemin/node_modules/through2/node_modules/readable-stream/lib/_stream_transform.js:79:12)
```
Please indentify and fix the error.

- Hint, what was the last task executed?

- Could we use any tool to find what was the last bit executed that caused the problem?

At a first sight at the logs, it seems that the problem is comming from `gulp-iconfont` or `gulp-imagemin` dependencies.
- Where is that dependency used in our project? 
- Could we pipe the execution of this dependency to 'gulp-debug' to try to identify which file is conflicting?

[gulp-debug](https://www.npmjs.com/package/gulp-debug)

```
...
var debug   = require('gulp-debug')
...
return gulp.src(settings.src)
    .pipe(debug({title: 'svgSprite'}))
    .pipe(imagemin())
...
```


now our logs will produce something like the following:


```
[16:04:27] Starting 'svgSprite'...
[16:04:27] svgSprite src/sprites/facebook.svg
[16:04:27] images src/images/gulp-starter-logo.png
[16:04:27] svgSprite src/sprites/instagram.svg
[16:04:27] images src/images/gulp.png
[16:04:27] images 2 items
[16:04:27] svgSprite src/sprites/twitter.svg

/Users/pablomolina/Projects/gulpAcademy/node_modules/gulp-iconfont/node_modules/gulp-ttf2woff2/node_modules/ttf2woff2/jssrc/ttf2woff2.js:1
aughtException",(function(ex){if(!(ex instanceof ExitStatus)){throw ex}}));Mod
```
This will let us identify that there is a problem with *src/sprites/twitter.svg*. Can you open this file in chrome browser? Is there any error message?


Once this error is fixed, is there any other errors? Fix them.

```
gulp-notify: [Error running Gulp] Error:
Unexpected close tag
Line:
0
Column:
872
Char:
>
```


#### B) Create a new file under /gulpfile.js/tasks/utils, name it *prefixTimestamp.js* 

* Write a gulp plugin in *prefixTimestamp.js* that appends an `@Author` and `@Date` timestamp tags at the begging of each file processed in a JS comment syntax.

[gulp writing a plugin](https://github.com/gulpjs/gulp/blob/master/docs/writing-a-plugin/dealing-with-streams.md)

```
/** 
 * @Author pablo.molina@netcentric.biz 
 * @Date: 1444042345638
*/ 
```

* Write a *'postJS'* task that gets all files generated by webpack target folder publish/javascripts and pipes such files through the newly created plugin, at the end, the files should also reside in publish/javascripts but contain the timestamp and author tags in a JS comment. Note that the plugin should also produce some logs of the file being processed.


```
[12:52:25] Appending timestamp and author tag to: /Users/pablomolina/Projects/gulpAcademy/public/javascripts/1.1.js
[12:52:25] Appending timestamp and author tag to: /Users/pablomolina/Projects/gulpAcademy/public/javascripts/2.2.js
[12:52:25] Appending timestamp and author tag to: /Users/pablomolina/Projects/gulpAcademy/public/javascripts/app.js
[12:52:25] Appending timestamp and author tag to: /Users/pablomolina/Projects/gulpAcademy/public/javascripts/page.js
[12:52:25] Appending timestamp and author tag to: /Users/pablomolina/Projects/gulpAcademy/public/javascripts/shared.js
```

















